import{jsx as e}from"react/jsx-runtime";import{createContext as t,useState as n,useContext as r,useRef as o,useCallback as i,useEffect as c,useMemo as a}from"react";var u=function(e){if(!e||!e.item)return{track:null,timestamp:null,is_playing:!1};var t=e.item,n=e.progress_ms,r=e.timestamp;return{track:{id:t.id,name:t.name,artist:t.artists,album:t.album.name,image:t.album.images[0].url,duration:t.duration_ms,progress:n,uri:t.uri},timestamp:r,is_playing:!0}},s=t({clientId:"",clientSecret:"",refreshToken:"",accessToken:"",setAccessToken:function(){}}),l=function(t){var r=t.children,o=t.clientId,i=t.clientSecret,c=t.refreshToken,a=n(""),u=a[0],l=a[1];return e(s.Provider,{value:{clientId:o,clientSecret:i,refreshToken:c,accessToken:u,setAccessToken:l},children:r})},f=function(){return f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},f.apply(this,arguments)};function d(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,a)}u((r=r.apply(e,t||[])).next())}))}function v(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=a(0),c.throw=a(1),c.return=a(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,a[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}"function"==typeof SuppressedError&&SuppressedError;var h=function(e,t){return d(void 0,void 0,void 0,(function(){var n;return v(this,(function(r){switch(r.label){case 0:return[4,fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{Authorization:"Basic ".concat(e),"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:t}).toString()})];case 1:if(401===(n=r.sent()).status)throw new Error("Invalid refresh token");return[2,n.json()]}}))}))},p=function(e){var t=r(e);if(!t)throw new Error("useCurrentTrack must be used within a SpotifyConnectContextProvider");return t};function m(e,t){var r=this;void 0===t&&(t=1e4);var a=o(null),u=o(!1),s=n({data:null,loading:!0,error:null}),l=s[0],h=s[1],p=i((function(){return d(r,void 0,void 0,(function(){var t,n;return v(this,(function(r){switch(r.label){case 0:if(!function(){try{return"undefined"==typeof document||void 0===document.visibilityState||"visible"===document.visibilityState}catch(e){return!1}}()||u.current)return[3,5];r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,e()];case 2:return t=r.sent(),h({data:t,error:null,loading:!1}),[3,5];case 3:return n=r.sent(),h({error:n instanceof Error?n:new Error(String(n)),data:null,loading:!1}),[3,5];case 4:return u.current=!1,[7];case 5:return[2]}}))}))}),[e]);return c((function(){if(!(t<=1e3))return p(),a.current=setInterval(p,t),function(){clearInterval(a.current),u.current=!1};h({data:null,loading:!1,error:new Error("Minimum accepted value of refetchInterval is ".concat(1e3,"!"))})}),[t,p]),f({},l)}var y=function(e){void 0===e&&(e=1e4);var t=p(s),n=t.clientId,r=t.clientSecret,o=t.refreshToken,u=t.accessToken,l=t.setAccessToken,f=a((function(){return Buffer.from("".concat(n,":").concat(r)).toString("base64")}),[n,r]);c((function(){d(void 0,void 0,void 0,(function(){var e;return v(this,(function(t){switch(t.label){case 0:return u?[3,2]:[4,h(f,o)];case 1:if(!(e=t.sent().access_token))throw new Error("Invalid access token");l(e),t.label=2;case 2:return[2]}}))}))}),[u]);var y=i((function(){return d(void 0,void 0,void 0,(function(){var e;return v(this,(function(t){return e=function(e){return d(void 0,[e],void 0,(function(e){var t,n=e.accessToken;return v(this,(function(e){switch(e.label){case 0:return n?[4,fetch("https://api.spotify.com/v1/me/player/currently-playing",{headers:{Authorization:"Bearer ".concat(n)}})]:[2];case 1:return 401===(t=e.sent()).status?(l(null),[2,{is_playing:!1}]):204===t.status||t.status>400?[2,{is_playing:!1}]:[4,t.json()];case 2:return[2,e.sent()]}}))}))},u?[2,e({accessToken:u})]:[2,{data:null,loading:!0,error:null}]}))}))}),[u,f,o]);return m(y,e)},b=function(e,t){void 0===e&&(e=3e4),void 0===t&&(t=5);var n=p(s),r=n.clientId,o=n.clientSecret,u=n.refreshToken,l=n.accessToken,f=n.setAccessToken;if(t>20)throw new Error("Invalid limit provided limit=".concat(t,". It should not exceed 20."));var y=a((function(){return Buffer.from("".concat(r,":").concat(o)).toString("base64")}),[r,o]);c((function(){d(void 0,void 0,void 0,(function(){var e;return v(this,(function(t){switch(t.label){case 0:return l?[3,2]:[4,h(y,u)];case 1:if(!(e=t.sent().access_token))throw new Error("Invalid access token");f(e),t.label=2;case 2:return[2]}}))}))}),[l]);var b=i((function(){return d(void 0,void 0,void 0,(function(){var e;return v(this,(function(n){return e=function(e){return d(void 0,[e],void 0,(function(e){var n,r=e.accessToken;return v(this,(function(e){switch(e.label){case 0:return r?[4,fetch("".concat("https://api.spotify.com/v1/me/player/recently-played","?limit=").concat(t),{headers:{Authorization:"Bearer ".concat(r)}})]:[2];case 1:return 401===(n=e.sent()).status?(f(null),[2,{is_playing:!1}]):204===n.status||n.status>400?[2,{is_playing:!1}]:[4,n.json()];case 2:return[2,e.sent()]}}))}))},l?[2,e({accessToken:l})]:[2,{data:null,loading:!0,error:null}]}))}))}),[l,y,u]);return m(b,e)};export{l as SpotifyConnectContextProvider,u as parseCurrentTrack,y as useCurrentTrack,b as useRecentTracks};
//# sourceMappingURL=index.es.js.map
